<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Details</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><a href="index.html">Insert</a></li>
                <li><a href="details.html">Details</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <h1>Student Details</h1>
        <table border="1">
            <thead>
                <tr>
                    <th>Roll No</th>
                    <th>Name</th>
                    <th>Branch</th>
                    <th>Email</th>
                    <th>Contact</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="studentTable"></tbody>
        </table>
    </div>

    <!-- Update Form (Hidden by Default) -->
    <div class="update-form" style="display: none;">
        <h2>Update Student</h2>
        <form id="updateForm" onsubmit="updateStudent(event)">
            <input type="hidden" id="updateRoll">
            <label for="updateName">Name:</label>
            <input type="text" id="updateName" required>
            <label for="updateBranch">Branch:</label>
            <select id="updateBranch">
                <option value="CSE">CSE</option>
                <option value="ECE">ECE</option>
                <option value="EEE">EEE</option>
                <option value="CSD">CSD</option>
                <option value="IT">IT</option>
            </select>
            <label for="updateEmail">College Email:</label>
            <input type="email" id="updateEmail" required>
            <label for="updateContact">Contact No:</label>
            <input type="text" id="updateContact" required>
            <button type="submit">Update</button>
            <button type="button" onclick="closeUpdateForm()">Cancel</button>
        </form>
    </div>

    <script>
        async function fetchStudents() {
            try {
                const response = await fetch('http://localhost:3000/get-students');
                const students = await response.json();
                const table = document.getElementById("studentTable");
                table.innerHTML = ""; // Clear previous data

                students.forEach(student => {
                    table.innerHTML += `
                        <tr>
                            <td>${student.roll}</td>
                            <td>${student.name}</td>
                            <td>${student.branch}</td>
                            <td>${student.cemail}</td>
                            <td>${student.contact}</td>
                            <td>
                                <button onclick="showUpdateForm('${student.roll}', '${student.name}', '${student.branch}', '${student.cemail}', '${student.contact}')">Update</button>
                                <button onclick="deleteStudent('${student.roll}')">Delete</button>
                            </td>
                        </tr>`;
                });
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function showUpdateForm(roll, name, branch, email, contact) {
            document.querySelector(".update-form").style.display = "block";
            document.getElementById("updateRoll").value = roll;
            document.getElementById("updateName").value = name;
            document.getElementById("updateBranch").value = branch;
            document.getElementById("updateEmail").value = email;
            document.getElementById("updateContact").value = contact;
        }

        function closeUpdateForm() {
            document.querySelector(".update-form").style.display = "none";
        }

        async function updateStudent(event) {
            event.preventDefault();

            const roll = document.getElementById("updateRoll").value;
            const updatedData = {
                name: document.getElementById("updateName").value,
                branch: document.getElementById("updateBranch").value,
                cemail: document.getElementById("updateEmail").value,
                contact: document.getElementById("updateContact").value
            };

            try {
                const response = await fetch(`http://localhost:3000/update-student/${roll}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedData),
                });

                const result = await response.json();
                alert(result.message);
                closeUpdateForm();
                fetchStudents();
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function deleteStudent(roll) {
            if (!confirm("Are you sure you want to delete this student?")) return;

            try {
                await fetch(`http://localhost:3000/delete-student/${roll}`, { method: 'DELETE' });
                alert("Student deleted successfully!");
                fetchStudents();
            } catch (error) {
                console.error('Error:', error);
            }
        }

        fetchStudents(); // Load students when page loads
    </script>
</body>
</html>
